<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RHACM Global Hub Monitor</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Red Hat Display', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { color: #06c; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin: 20px 0; }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 { color: #151515; margin-bottom: 15px; border-bottom: 2px solid #06c; padding-bottom: 10px; }
        .status { padding: 4px 12px; border-radius: 4px; font-size: 14px; font-weight: 600; display: inline-block; }
        .status.ready { background: #e7f1e7; color: #3e8635; }
        .status.notready { background: #faeae8; color: #c9190b; }
        .info-row { margin: 10px 0; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .info-row:last-child { border-bottom: none; }
        .label { display: inline-block; font-weight: 600; color: #6a6e73; min-width: 120px; }
        .value { color: #151515; }
        .badge { background: #06c; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .loading { text-align: center; padding: 40px; }
        .error { background: #faeae8; color: #c9190b; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .tabs { display: flex; border-bottom: 2px solid #d2d2d2; margin: 20px 0; }
        .tab { padding: 12px 24px; cursor: pointer; border: none; background: none; font-size: 16px; }
        .tab.active { border-bottom: 3px solid #06c; color: #06c; font-weight: 600; margin-bottom: -2px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #d2d2d2; }
        th { background: #f0f0f0; font-weight: 600; }
        .policy-compliant { background: #e7f1e7; color: #3e8635; padding: 4px 8px; border-radius: 4px; }
        .policy-noncompliant { background: #faeae8; color: #c9190b; padding: 4px 8px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç RHACM Global Hub Monitor</h1>
        
        <div id="app">
            <div class="loading">Loading...</div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api';

        async function fetchHubs() {
            try {
                const response = await fetch(`${API_BASE}/hubs`);
                const data = await response.json();
                if (data.success) {
                    renderHubs(data.data);
                } else {
                    showError(data.error || 'Failed to load hubs');
                }
            } catch (error) {
                showError('Error connecting to API: ' + error.message);
            }
        }

        function renderHubs(hubs) {
            const app = document.getElementById('app');
            let html = '<h2>Managed Hubs</h2><div class="grid">';
            
            hubs.forEach(hub => {
                const totalSpokes = hub.managedClusters?.length || 0;
                const totalPolicies = hub.policiesInfo?.length || 0;
                const totalNodes = hub.nodesInfo?.length || 0;
                const statusClass = hub.status.toLowerCase().includes('ready') ? 'ready' : 'notready';
                
                html += `
                    <div class="card">
                        <h3>${hub.name} <span class="status ${statusClass}">${hub.status}</span></h3>
                        <div class="info-row">
                            <span class="label">OpenShift:</span>
                            <span class="value">${hub.clusterInfo.openshiftVersion || 'N/A'}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Platform:</span>
                            <span class="value">${hub.clusterInfo.platform || 'N/A'}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Spokes:</span>
                            <span class="badge">${totalSpokes}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Nodes:</span>
                            <span class="badge">${totalNodes}</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Policies:</span>
                            <span class="badge">${totalPolicies}</span>
                        </div>
                        ${hub.clusterInfo.consoleURL ? `
                        <div class="info-row">
                            <a href="${hub.clusterInfo.consoleURL}" target="_blank">üîó Open Console</a>
                        </div>
                        ` : ''}
                        <button onclick="showHubDetails('${hub.name}')" style="margin-top: 10px; padding: 8px 16px; background: #06c; color: white; border: none; border-radius: 4px; cursor: pointer;">View Details</button>
                    </div>
                `;
            });
            
            html += '</div>';
            app.innerHTML = html;
        }

        async function showHubDetails(hubName) {
            const app = document.getElementById('app');
            app.innerHTML = '<div class="loading">Loading hub details...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/hubs/${hubName}`);
                const data = await response.json();
                if (data.success) {
                    renderHubDetails(data.data);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('Error: ' + error.message);
            }
        }

        function renderHubDetails(hub) {
            const app = document.getElementById('app');
            
            let html = `
                <button onclick="fetchHubs()" style="margin-bottom: 20px; padding: 8px 16px; background: #f0f0f0; border: 1px solid #d2d2d2; border-radius: 4px; cursor: pointer;">‚Üê Back to Hubs</button>
                <h2>${hub.name} <span class="status ${hub.status.toLowerCase().includes('ready') ? 'ready' : 'notready'}">${hub.status}</span></h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab(0)">Overview</button>
                    <button class="tab" onclick="switchTab(1)">Spokes (${hub.managedClusters?.length || 0})</button>
                    <button class="tab" onclick="switchTab(2)">Nodes (${hub.nodesInfo?.length || 0})</button>
                    <button class="tab" onclick="switchTab(3)">Policies (${hub.policiesInfo?.length || 0})</button>
                </div>
                
                <div class="tab-content active" id="tab-0">
                    <div class="card">
                        <h3>Cluster Information</h3>
                        <div class="info-row"><span class="label">Name:</span> <span class="value">${hub.name}</span></div>
                        <div class="info-row"><span class="label">Kubernetes:</span> <span class="value">${hub.version || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">OpenShift:</span> <span class="value">${hub.clusterInfo.openshiftVersion || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">Platform:</span> <span class="value">${hub.clusterInfo.platform || 'N/A'}</span></div>
                        ${hub.clusterInfo.consoleURL ? `<div class="info-row"><span class="label">Console:</span> <span class="value"><a href="${hub.clusterInfo.consoleURL}" target="_blank">${hub.clusterInfo.consoleURL}</a></span></div>` : ''}
                    </div>
                </div>
                
                <div class="tab-content" id="tab-1">
                    ${renderSpokeClusters(hub.managedClusters || [])}
                </div>
                
                <div class="tab-content" id="tab-2">
                    ${renderNodes(hub.nodesInfo || [])}
                </div>
                
                <div class="tab-content" id="tab-3">
                    ${renderPolicies(hub.policiesInfo || [])}
                </div>
            `;
            
            app.innerHTML = html;
        }

        function renderSpokeClusters(spokes) {
            if (spokes.length === 0) return '<div class="card"><p>No spoke clusters found</p></div>';
            
            let html = '<div class="grid">';
            spokes.forEach(spoke => {
                html += `
                    <div class="card">
                        <h3>${spoke.name} <span class="status ${spoke.status.toLowerCase().includes('ready') ? 'ready' : 'notready'}">${spoke.status}</span></h3>
                        <div class="info-row"><span class="label">OpenShift:</span> <span class="value">${spoke.clusterInfo.openshiftVersion || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">Platform:</span> <span class="value">${spoke.clusterInfo.platform || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">Policies:</span> <span class="badge">${spoke.policiesInfo?.length || 0}</span></div>
                        <div class="info-row"><span class="label">Nodes:</span> <span class="badge">${spoke.nodesInfo?.length || 0}</span></div>
                        ${renderSpokeNodes(spoke.nodesInfo || [])}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderSpokeNodes(nodes) {
            if (nodes.length === 0) return '';
            
            let html = '<div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #f0f0f0;"><strong>Node Hardware:</strong>';
            nodes.forEach(node => {
                html += `
                    <div style="margin-top: 10px; font-size: 13px;">
                        <div>üíª CPU: ${node.capacity?.cpu || 'N/A'}</div>
                        <div>üß† RAM: ${node.capacity?.memory || 'N/A'}</div>
                        <div>üíæ Storage: ${node.capacity?.storage || 'N/A'}</div>
                        <div>üåê IP: ${node.internalIP || 'N/A'}</div>
                        ${node.annotations?.['bmc-address'] ? `<div>üîß BMC: ${node.annotations['bmc-address'].split('//')[1] || node.annotations['bmc-address']}</div>` : ''}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderNodes(nodes) {
            if (nodes.length === 0) return '<div class="card"><p>No node information available</p></div>';
            
            let html = '<div class="grid">';
            nodes.forEach(node => {
                html += `
                    <div class="card">
                        <h3>${node.name.split('.')[0]}</h3>
                        <div class="info-row"><span class="label">Status:</span> <span class="status ${node.status.toLowerCase().includes('ready') ? 'ready' : 'notready'}">${node.status}</span></div>
                        <div class="info-row"><span class="label">CPU:</span> <span class="value">${node.capacity?.cpu || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">RAM:</span> <span class="value">${node.capacity?.memory || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">Storage:</span> <span class="value">${node.capacity?.storage || 'N/A'}</span></div>
                        <div class="info-row"><span class="label">IP Address:</span> <span class="value">${node.internalIP || 'N/A'}</span></div>
                        ${node.annotations?.['bmc-address'] ? `<div class="info-row"><span class="label">BMC:</span> <span class="value" style="font-size: 11px;">${node.annotations['bmc-address']}</span></div>` : ''}
                        ${node.annotations?.manufacturer ? `<div class="info-row"><span class="label">Vendor:</span> <span class="value">${node.annotations.manufacturer}</span></div>` : ''}
                        ${node.annotations?.['product-name'] ? `<div class="info-row"><span class="label">Model:</span> <span class="value">${node.annotations['product-name']}</span></div>` : ''}
                        ${node.annotations?.['nic-count'] ? `<div class="info-row"><span class="label">NICs:</span> <span class="value">${node.annotations['nic-count']}</span></div>` : ''}
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderPolicies(policies) {
            if (policies.length === 0) return '<div class="card"><p>No policies found</p></div>';
            
            let html = `
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Policy Name</th>
                                <th>Compliance</th>
                                <th>Remediation</th>
                                <th>Standards</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            policies.forEach(policy => {
                const policyName = policy.name.split('.').pop();
                const complianceClass = policy.complianceState?.toLowerCase() === 'compliant' ? 'policy-compliant' : 'policy-noncompliant';
                html += `
                    <tr>
                        <td>
                            <strong>${policyName}</strong><br>
                            <small style="color: #6a6e73;">${policy.namespace}</small>
                        </td>
                        <td><span class="${complianceClass}">${policy.complianceState || 'Unknown'}</span></td>
                        <td>${policy.remediationAction || 'N/A'}</td>
                        <td>${policy.standards?.join(', ') || 'N/A'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            return html;
        }

        function switchTab(index) {
            // Hide all tabs
            for (let i = 0; i < 4; i++) {
                const content = document.getElementById(`tab-${i}`);
                const tab = document.querySelectorAll('.tab')[i];
                if (content) content.classList.remove('active');
                if (tab) tab.classList.remove('active');
            }
            
            // Show selected tab
            const selectedContent = document.getElementById(`tab-${index}`);
            const selectedTab = document.querySelectorAll('.tab')[index];
            if (selectedContent) selectedContent.classList.add('active');
            if (selectedTab) selectedTab.classList.add('active');
        }

        function showError(message) {
            document.getElementById('app').innerHTML = `
                <div class="error">
                    <strong>Error:</strong> ${message}
                    <br><br>
                    <button onclick="fetchHubs()" style="padding: 8px 16px; background: white; border: 1px solid #c9190b; border-radius: 4px; cursor: pointer;">Retry</button>
                </div>
            `;
        }

        // Load hubs on page load
        fetchHubs();
    </script>
</body>
</html>

